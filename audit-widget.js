const d=document,s=[...d.scripts],b=document.body,w=window,S=s.map(el=>el.src),wrap=d.createElement("div");wrap.style.cssText="position:fixed;bottom:20px;right:20px;width:380px;background:#1e1e1e;color:#fff;padding:16px;font-family:monospace;font-size:13px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.5);z-index:99999;line-height:1.6;";const st=x=>x?"‚úÖ":"‚ùå",tooltip=txt=>`<span style="display:inline-block;margin-left:6px;background:#007acc;color:#fff;border-radius:50%;padding:0 6px;font-weight:bold;cursor:help;" title="${txt}">?</span>`,ymScript=S.find(src=>src.includes("mc.yandex.ru")),ymInit=/ym\(\s*\d+\s*,\s*["']init["']/.test(d.documentElement.innerHTML),hasYM=typeof ym==="function",yaCounters=Object.keys(w).filter(k=>/^yaCounter\d+$/.test(k)),yaIds=yaCounters.map(c=>c.replace("yaCounter","")).join(", ")||"‚Äî",hasGTM=typeof dataLayer!=="undefined",gtmScript=S.find(src=>src.includes("googletagmanager.com/gtm.js")),gtmId=gtmScript?.match(/id=(GTM-[^&]+)/)?.[1]||"",hasGA4=S.some(s=>s.includes("gtag/js"))||/G-[\w\d]+/.test(d.documentElement.innerHTML),hasVK=S.some(s=>s.includes("vk.com/rtrg"))||d.documentElement.innerHTML.includes("VK-RTRG"),hasMT=S.some(s=>s.includes("ads.mytarget.ru"))||d.documentElement.innerHTML.includes("MyTarget"),hasMeta=S.some(s=>s.includes("connect.facebook.net"))||/fbq\(["']init["']/.test(d.documentElement.innerHTML),ymUid=document.cookie.match(/_ym_uid=([^;]+)/)?.[1]||"–Ω–µ –Ω–∞–π–¥–µ–Ω–æ",hasEc=!!(w.dataLayer?.some(e=>Object.keys(e).some(k=>/ecommerce/i.test(k)))||w.yandex_metrika_callbacks2?.some(fn=>fn.toString().includes("ecommerce"))),mIndex=s.findIndex(el=>el.src.includes("mc.yandex.ru")),gIndex=s.findIndex(el=>el.src.includes("gtm.js"));let metricPos="üìç –ü–æ—Ä—è–¥–æ–∫ –ú–µ—Ç—Ä–∏–∫–∏ –∏ GTM –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω";if(mIndex!==-1&&gIndex!==-1){metricPos=mIndex<gIndex?"üìç –ú–µ—Ç—Ä–∏–∫–∞ —Å—Ç–æ–∏—Ç –¥–æ GTM":"üìç –ú–µ—Ç—Ä–∏–∫–∞ —Å—Ç–æ–∏—Ç –ø–æ—Å–ª–µ GTM"}else if(mIndex===-1&&gIndex!==-1){metricPos="üìç –ú–µ—Ç—Ä–∏–∫–∞, –≤–µ—Ä–æ—è—Ç–Ω–æ, –≤–Ω—É—Ç—Ä–∏ GTM"}const isDuplicate=yaCounters.length&&ymInit&&gtmScript&&ymScript;wrap.innerHTML=`<div style="font-size:15px;font-weight:bold;padding-bottom:8px;">–ê–£–î–ò–¢ –°–ß–Å–¢–ß–ò–ö–û–í –ò –≠–õ–ï–ú–ï–ù–¢–û–í –ù–ê –°–ê–ô–¢–ï</div><div>üì¶ –ú–µ—Ç—Ä–∏–∫–∞: ${st(yaCounters.length||ymInit)} ${tooltip("–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.")}</div><div>üîß ym-—Ñ—É–Ω–∫—Ü–∏—è: ${st(hasYM)} ${tooltip("–§—É–Ω–∫—Ü–∏—è ym() –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π.")}</div><div>üìú –°–∫—Ä–∏–ø—Ç –ú–µ—Ç—Ä–∏–∫–∏: ${st(!!ymScript)} ${tooltip("–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ —Å mc.yandex.ru.")}</div><div>‚úÖ YACOUNTER: ${yaIds} ${tooltip("–ù–æ–º–µ—Ä–∞ –≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤ –ú–µ—Ç—Ä–∏–∫–∏.")}</div><div>üü• GTM: ${st(hasGTM)} ${tooltip("–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ–±—ä–µ–∫—Ç–∞ dataLayer –æ—Ç GTM.")}</div><div>üìò GTM.js: ${st(!!gtmScript)} ${tooltip("–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ GTM.")}</div>${gtmId?`<div style="margin-left:10px;">ID: ${gtmId} ${tooltip("–ù–æ–º–µ—Ä GTM-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.")}</div>`:""}<div>üìä GA4 (gtag.js): ${st(hasGA4)} ${tooltip("–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è GA4: —Å–∫—Ä–∏–ø—Ç–∞ gtag.js –∏–ª–∏ ID G-XXXX.")}</div><div>üì° VK Pixel: ${st(hasVK)} ${tooltip("–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–∏–∫—Å–µ–ª—è –í–ö–æ–Ω—Ç–∞–∫—Ç–µ (rtrg).")}</div><div>üéØ MYTARGET PIXEL: ${st(hasMT)} ${tooltip("–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–∏–∫—Å–µ–ª—è —Ä–µ–∫–ª–∞–º—ã myTarget.")}</div><div>üìò META (FB/Instagram): ${st(hasMeta)} ${tooltip("–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–∏–∫—Å–µ–ª—è Facebook/Instagram (Meta).")}</div><div style="color:#aaa;margin-top:4px;">${metricPos}</div>${isDuplicate?`<div style="color:#ffd500">‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ú–µ—Ç—Ä–∏–∫–∏ ${tooltip("–°—á—ë—Ç—á–∏–∫ –ú–µ—Ç—Ä–∏–∫–∏ –Ω–∞–π–¥–µ–Ω –∏ –≤ –∫–æ–¥–µ, –∏ –≤–Ω—É—Ç—Ä–∏ GTM ‚Äî —ç—Ç–æ –ø–ª–æ—Ö–æ.")}</div>`:""}<div style="background:#ffea00;color:#000;border-radius:4px;padding:4px;margin-top:8px;">–ú–µ—Ç—Ä–∏–∫–∞: #${mIndex>=0?mIndex:"‚Äî"}</div><div style="background:#a0ffff;color:#000;border-radius:4px;padding:4px;">GTM: #${gIndex>=0?gIndex:"‚Äî"}</div>${mIndex>=0&&gIndex>=0?`<div style="background:#d0ffd0;color:#000;border-radius:4px;padding:4px;">–ú–µ—Ç—Ä–∏–∫–∞ ${mIndex<gIndex?"–¥–æ":"–ø–æ—Å–ª–µ"} GTM</div>`:""}<div style="background:#e0f7ff;color:#000;border-radius:4px;padding:4px;">üß† _ym_uid: ${ymUid} ${tooltip("ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ú–µ—Ç—Ä–∏–∫–∏ ‚Äî –∫—É–∫–∞ _ym_uid.")}</div><div style="background:#eee;color:#000;border-radius:4px;padding:4px;">üõí Ecommerce: ${hasEc?"–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞":"–ù–µ—Ç"} ${tooltip("–ï—Å—Ç—å –ª–∏ —Å–æ–±—ã—Ç–∏—è ecommerce –≤ dataLayer –∏–ª–∏ –≤ –ú–µ—Ç—Ä–∏–∫–µ.")}</div><div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;"><div style="font-size:18px;color:#aaa;">¬© –ö–æ–Ω—Ç–æ—Ä–∞</div><button id="audit-close" style="font-size:18px;background:#ff3366;color:#fff;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;">–ó–ê–ö–†–´–¢–¨</button></div>`;d.getElementById("analytics-audit-widget")?.remove();wrap.id="analytics-audit-widget";b.appendChild(wrap);d.getElementById("audit-close").onclick=()=>wrap.remove();
